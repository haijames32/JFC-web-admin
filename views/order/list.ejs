<%- include('../includes/header.ejs') %>


   <div class="container-fuild">

      <div class="container col-9" style="margin-top: 70px;">
         <h1 class="fw-semibold">Orders</h1>
      </div>
      <hr>

      <div class="container col-8">

         <div class="container d-flex align-items-center mb-2" style="justify-content: space-between;">
            <div>
               <a href="/users" class="btn text-white btn-primary" data-mdb-ripple-init>
                  <i class="fas fa-refresh"></i>
               </a>
            </div>
            <div class="d-flex">
               <div class="input-group me-3">
                  <form class="d-flex" action="" method="get">
                     <div class="form-outline" data-mdb-input-init>
                        <input type="search" id="form1" class="form-control" name="searchOrder" style="width: 200px;" />
                        <label class="form-label" for="form1">Search</label>
                     </div>
                     <button type="submit" class="btn btn-primary" style="z-index: 0;" data-mdb-ripple-init>
                        <i class="fas fa-search"></i>
                     </button>
                  </form>
               </div>
               <a href="/orders/finished" class="btn text-white btn-primary" data-mdb-ripple-init>
                  <i class="fas fa-history"></i>
               </a>
            </div>
         </div>

         <table class="table table-hover table-bordered table-sm align-middle mb-0 bg-white">
            <thead class="bg-light">
               <tr class="table-secondary">
                  <th scope="col" style="font-size: 15px;">#</th>
                  <th scope="col" style="font-size: 15px;">User</th>
                  <th scope="col" style="font-size: 15px;">Date</th>
                  <th scope="col" style="font-size: 15px;">Payment</th>
                  <th scope="col" style="font-size: 15px;">Status</th>
                  <th scope="col" style="font-size: 15px;">Total</th>
                  <th scope="col" style="font-size: 15px;">Actions</th>
               </tr>
            </thead>
            <tbody>
               <% listOrder.forEach((item, index)=>{ %>
                  <tr style="cursor: pointer;">
                     <td>
                        <a class="text-black" href="/orders/<%= item._id %>">
                           <%= index + 1 %>
                        </a>
                     </td>
                     <td>
                        <a class="text-black" href="/orders/<%= item._id %>">
                           <%= item.userId.name %>
                        </a>
                     </td>
                     <td>
                        <a class="text-black" href="/orders/<%= item._id %>">
                           <%= item.date %>
                        </a>
                     </td>
                     <td>
                        <a class="text-black" href="/orders/<%= item._id %>">
                           <%= item.paymentMethod %>
                        </a>
                     </td>
                     <td>
                        <a class="text-black" href="/orders/<%= item._id %>">
                           <% if(item.status=='Hoàn thành' ){ %>
                              <span class="badge badge-success rounded-pill d-inline">
                                 <%= item.status %>
                              </span>
                              <% }else if(item.status=='Đã nhận hàng' ){ %>
                                 <span class="badge badge-primary rounded-pill d-inline">
                                    <%= item.status %>
                                 </span>
                                 <% }else if(item.status=='Đang giao hàng' ){%>
                                    <span class="badge badge-info rounded-pill d-inline">
                                       <%= item.status %>
                                    </span>
                                    <% }else if(item.status=='Đã xác nhận' ){%>
                                       <span class="badge badge-primary rounded-pill d-inline">
                                          <%= item.status %>
                                       </span>
                                       <% }else if(item.status=='Chờ xác nhận' ){ %>
                                          <span class="badge badge-warning rounded-pill d-inline">
                                             <%= item.status %>
                                          </span>
                                          <%}else if(item.status=='Đã thanh toán và chờ xác nhận' ){%>
                                             <span class="badge badge-warning rounded-pill d-inline">
                                                <%= item.status %>
                                             </span>
                                             <%}else{%>
                                                <span class="badge badge-danger rounded-pill d-inline">
                                                   <%= item.status %>
                                                </span>
                                                <% } %>
                        </a>
                     </td>
                     <td>
                        <a class="text-black" href="/orders/<%= item._id %>">
                           <%= item.total.toLocaleString() %>₫
                        </a>
                     </td>
                     <td>
                        <% if(item.status=='Chờ xác nhận' || item.status=='Đã thanh toán và chờ xác nhận' ){%>
                           <form method="post" action="/orders/<%= item._id %>/status?_method=PUT" name="updateStatus">
                              <input name="changeStatus" value="confirm" hidden>
                              <button type="button" id="btn-update-status" class="btn btn-sm btn-primary btn-rounded"
                                 data-mdb-ripple-init>Xác nhận</button>
                           </form>
                           <% }else if(item.status=='Đã xác nhận' ){ %>
                              <form method="post" action="/orders/<%= item._id %>/status?_method=PUT"
                                 name="updateStatus">
                                 <input name="changeStatus" value="delivering" hidden>
                                 <button type="button" id="btn-update-status" class="btn btn-sm btn-info btn-rounded"
                                    data-mdb-ripple-init>Bắt đầu
                                    giao</button>
                              </form>
                              <% }else if(item.status=='Đã nhận hàng' ){ %>
                                 <form method="post" action="/orders/<%= item._id %>/status?_method=PUT"
                                    name="updateStatus">
                                    <input name="changeStatus" value="finish" hidden>
                                    <button type="button" id="btn-update-status"
                                       class="btn btn-sm btn-success btn-rounded" data-mdb-ripple-init>Hoàn
                                       thành</button>
                                 </form>
                                 <% }else{ null } %>
                     </td>
                  </tr>
                  <% }) %>
            </tbody>
         </table>

         <% if(listOrder.length==0){ %>
            <div class="text-center mt-4">
               <div>
                  <img src="https://img.icons8.com/color/96/general-warning-sign.png" class="img rounded"
                     style="width: 80px; height: 80px;" alt="">
               </div>
               <h5 class="fw-semibold text-muted">Không có đơn hàng nào..</h5>
            </div>
            <% } %>

      </div>

   </div>





   <script>
      document.addEventListener('DOMContentLoaded', () => {
         let orderId
         let btnUpdate = document.getElementById('btn-update-status')
         let updateForm = document.forms['updateStatus']

         btnUpdate.onclick = () => {
            updateForm.submit()
         }

      })
   </script>



   <%- include('../includes/footer.ejs') %>